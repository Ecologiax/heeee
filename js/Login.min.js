function Loader(n){n=="open"?KTApp.blockPage({overlayColor:"#000000",opacity:.3,type:"v2",state:"primary",message:sloggingInLabel}):n=="send"?KTApp.blockPage({overlayColor:"#000000",opacity:.3,type:"v2",state:"primary",message:"Sending..."}):$.unblockUI()}function doInnerLogic(n){var t=$(".clientId").val(),i=$(".username").val(),r=n.attr("href");n.attr("href",n.attr("href")+"?rmsClientId="+t+"&email="+i)}function GetIPAddress(){var n=$("#IPAddressToken").val();$.ajax({url:"https://rms9plusiplookup.azurewebsites.net/api/IPAddress",type:"GET",dataType:"json",data:{token:n},success:function(n){try{n.length===0?SecondTryGettingIPAddress():$(".IPAddress").val(n)}catch(t){$(".IPAddress").val("");console.error("IP Address Error",t);DisplayIPAddressError(t)}},error:function(n){$(".IPAddress").val("");console.error("IP Address Error",n);DisplayIPAddressError(n)}})}function DisplayIPAddressError(n){var t=window.open("","Error Window");t.document.write("<p>Error: "+n.toString()+"<\/p>")}function SecondTryGettingIPAddress(){var n=$("#IPAddressToken").val();$.ajax({url:"https://rms9plusiplookup.azurewebsites.net/api/IPAddress",type:"GET",dataType:"json",data:{token:n},success:function(n){try{$(".IPAddress").val(n)}catch(t){$(".IPAddress").val("");console.error("IP Address Error",t);DisplayIPAddressError(t)}},error:function(n){$(".IPAddress").val("");console.error("IP Address Error",n);DisplayIPAddressError(n)}})}function RemoveSAMLCookies(){listOfSAMLCookies&&listOfSAMLCookies.length&&$(".rsc")&&$(".rsc").each(function(){var n=$(this),t=n.attr("data-rmsclientno"),i=currentUrl+"/Login/RemoveSAMLCookie?rmsClientId="+t;n.on("click",function(){$.ajax({url:i,type:"GET",dataType:"json",data:{},success:function(){try{RefreshSamlCookies(t,n)}catch(i){console.error("Remove Saml Cookie Error",i)}},error:function(n){console.error("Remove Saml Cookie Error",n)}})})})}function RefreshSamlCookies(n,t){$.ajax({url:currentUrl+"/Login/RefreshSAMLCookie",type:"POST",dataType:"json",data:{listOfSamlUrls:listOfSAMLCookies,clientId:n},success:function(){var r,i,u;try{for(t.parent().remove(),r={},i=0;i<listOfSAMLCookies.length;i++)n==listOfSAMLCookies[i].RMSClientNo&&(r=listOfSAMLCookies[i]);u=listOfSAMLCookies.indexOf(r);u>-1&&listOfSAMLCookies.splice(u,1);listOfSAMLCookies.length==0&&$("#samlLogins").css("display","none")}catch(f){console.error("Remove Saml Cookie Error",f)}},error:function(n){console.error("Remove Saml Cookie Error",n)}})}var isSubmitBtnPressed=!1,googleDetails=null,auth2;$(function(){function h(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return n()+n(!0)+n(!0)+n()}function l(){try{gapi.signin2.render("my-signin2",{scope:"profile email",width:240,height:50,longtitle:!0,theme:"dark",onsuccess:r,onfailure:a})}catch(n){}}function r(n){var t=n.getAuthResponse().id_token,i=n.getBasicProfile().getEmail();$(".GoogleIdToken").val(t);$(".AuthenticationEmail").val(i);isSubmitBtnPressed&&$(".login-form").trigger("submit")}function a(n){console.log(n)}function s(){var n=$(".authentication-alert").dialog({autoOpen:!0,title:"Simple Pop up",dialogClass:"simple-modal authentication-alert-modal",show:"fadeIn",hide:"fadeOut",closeOnEscape:!0,draggable:!1,modal:!0,buttons:{Ok:{click:function(){$(this).dialog("close")},text:"Ok","class":"btn rmsBtn"}},resizable:!1});setTimeout(function(){window.addEventListener("keyup",function(t){typeof n!="undefined"&&t.keyCode===13&&($(".authentication-alert").dialog("close"),Loader("open"),$(".IsMicrosoftLogin").val(!0),$(".login-form").trigger("submit"))})},500)}function u(){var n=$(".clientId").val(),t=$(".username").val(),i=$(".pw-field").val();return n!=""&&typeof n!="undefined"&&t!=""&&typeof t!="undefined"&&i!=""&&typeof i!="undefined"?(console.log("Valid inputs"),!0):(console.log("Not valid inputs"),!1)}var c,o,n,f;RemoveSAMLCookies();localStorage.removeItem("openInFullScreen");dbNeedsUpdating&&($(".dbNeedsUpdating").val(!0),$(".connectionStringToUpdate").val(connectionStringToUpdate),Loader("open"),$(".login-form").trigger("submit"));var i=!1,t=!1,e=!1;(function(n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4)))&&(i=!0)})(navigator.userAgent||navigator.vendor||window.opera,"http://detectmobilebrowser.com/mobile");$(".login-form").on("submit",function(){var n=h();Cookies.remove("rms_csc");Cookies.set("rms_csc",n,{expires:1});$(".LoginCookie").val(n)});/Albert/i.test(navigator.userAgent)&&(t=!0);e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);i||t||e?$(".use-pc-version-override-chkbox").show():$(".use-mobile-version-override-chkbox").show();t&&($(".open-new-window-chkbox").css("display","none"),$(".use-pc-version-override-chkbox").css("display","none"),$(".use-mobile-version-override-chkbox").css("display","none"));c=$(".clientId").val();localStorage.getItem("tileStat_arrivals")!==null&&localStorage.removeItem("tileStat_arrivals");localStorage.getItem("tileStat_departures")!==null&&localStorage.removeItem("tileStat_departures");localStorage.getItem("tileStat_dirtyrooms")!==null&&localStorage.removeItem("tileStat_dirtyrooms");localStorage.getItem("tileStat_inhouse")!==null&&localStorage.removeItem("tileStat_inhouse");localStorage.getItem("tileStat_maintenance")!==null&&localStorage.removeItem("tileStat_maintenance");localStorage.getItem("tileStat_cleanrooms")!==null&&localStorage.removeItem("tileStat_cleanrooms");localStorage.getItem("tileStat_guestarrivals")!==null&&localStorage.removeItem("tileStat_guestarrivals");localStorage.getItem("tileStat_guestdepartures")!==null&&localStorage.removeItem("tileStat_guestdepartures");localStorage.getItem("tileStat_guestinhouse")!==null&&localStorage.removeItem("tileStat_guestinhouse");localStorage.getItem("tileStat_onlineBookings")!==null&&localStorage.removeItem("tileStat_onlineBookings");localStorage.getItem("tileStat_onlineNights")!==null&&localStorage.removeItem("tileStat_onlineNights");localStorage.getItem("tileStat_onlineRevenue")!==null&&localStorage.removeItem("tileStat_onlineRevenue");localStorage.getItem("tileGraph_marketSegments")!==null&&localStorage.removeItem("tileGraph_marketSegments");localStorage.getItem("tileGraph_occupancy")!==null&&localStorage.removeItem("tileGraph_occupancy");localStorage.getItem("tileGraph_positionList")!==null&&localStorage.removeItem("tileGraph_positionList");localStorage.getItem("bookingchart_propertyselected")!==null&&localStorage.removeItem("bookingchart_propertyselected");localStorage.getItem("bc_ExcludeBookingTimes")!==null&&localStorage.removeItem("bc_ExcludeBookingTimes");localStorage.getItem("bc_SpecialEventData")!==null&&localStorage.removeItem("bc_SpecialEventData");localStorage.getItem("bc_ChargePeriodData")!==null&&localStorage.removeItem("bc_ChargePeriodData");localStorage.getItem("bc_AllowPencilBookings")!==null&&localStorage.removeItem("bc_AllowPencilBookings");localStorage.getItem("bc_LastModifiedDate")!==null&&localStorage.removeItem("bc_LastModifiedDate");localStorage.getItem("bc_Attributes")!==null&&localStorage.removeItem("bc_Attributes");localStorage.getItem("bc_ExpandedCats")!==null&&localStorage.removeItem("bc_ExpandedCats");localStorage.getItem("bc_PropertyId")!==null&&localStorage.removeItem("bc_PropertyId");localStorage.getItem("dateOfRefresh")!==null&&localStorage.removeItem("dateOfRefresh");$(".username").on("blur",function(){var n=$(this);(n.val()=="*lj"||n.val()=="*ni"||n.val()=="*dw"||n.val()=="*jb")&&$(".pw-field").val("aa")});$("#Login").on("click",function(n){var e,f;$(".isTrainingHF").val(!1);isSubmitBtnPressed=!0;i||t;dbNeedsUpdating?($(".dbNeedsUpdating").val(!0),$(".connectionStringToUpdate").val(connectionStringToUpdate)):($(".dbNeedsUpdating").val(!1),$(".connectionStringToUpdate").val(""));e=$("#UserName").val();e.startsWith("*",0)?(n.preventDefault(),f=$(".username"),f.val()=="*lj"||f.val()=="*ni"||f.val()=="*dw"||f.val()=="*jb"?(Loader("open"),$(".IsGoogleLogin").val(!1),$(".IsMicrosoftLogin").val(!0),$(".login-form").trigger("submit")):u()&&(googleDetails==null?s():r(googleDetails))):u()&&((i||t)&&$("#preloader").css("display","block"),Loader("open"),$(".login-form").trigger("submit"))});l();var v,y=function(){v=gapi.auth2.init({client_id:"542591436265-spm9qd16quvq11mo16s64k5uj0f7ujvr.apps.googleusercontent.com",scope:"profile"});redirectErrorMessage&&redirectErrorMessage!=""&&(gapi.auth.setToken(null),gapi.auth.signOut())},k=function(n){console.log("Signin state changed to ",n)},d=function(){gapi.load("auth2",y)};$(".google-btn-signin").click(function(){$(".authentication-alert").dialog("close");Loader("open");$(".IsGoogleLogin").val(!0);$(".login-form").trigger("submit")});o=$(".azure-button");o.click(function(){$(".authentication-alert").dialog("close");Loader("open");$(".IsMicrosoftLogin").val(!0);$(".login-form").trigger("submit")});n=localStorage.getItem("RMSDefaultPrinter-Report");n&&n!=""&&(n=JSON.parse(n),n.data&&n.data!=""?$(".reportPrinterName").val(n.data):$(".reportPrinterName").val(""));$("#LoginTraining").confirmation({container:"body",btnOkClass:"btn btn-primary blue margin-right",btnOkIcon:"fa fa-check",btnCancelIcon:"fa fa-times",onConfirm:function(){if(u()){$(".isTrainingHF").val(!0);var n=$("#UserName").val();n.startsWith("*",0)?googleDetails==null?s():r(googleDetails):(Loader("open"),$(".isTrainingHF").val(!0),$(".login-form").trigger("submit"))}}});$("#resetPassword").on("click",function(){doInnerLogic($(this))});$("#createLogin").on("click",function(){doInnerLogic($(this))});if($("#ClientID").select(),$(".updatedb").length>0&&(Loader("close"),$(".updatedb").dialog({autoOpen:!0,title:"Simple Pop up",dialogClass:"simple-modal simple-modal-warning",show:"fadeIn",hide:"fadeOut",closeOnEscape:!0,draggable:!1,modal:!0,width:400,buttons:{Ok:{click:function(){dbNeedsUpdating?($(".dbNeedsUpdating").val(!0),$(".connectionStringToUpdate").val(connectionStringToUpdate),Loader("open"),$(".login-form").trigger("submit")):($(".dbNeedsUpdating").val(!1),$(".connectionStringToUpdate").val(""));$(this).dialog("close")},text:"Ok","class":"btn rmsBtn"}},resizable:!1})),$(".userLimitReached").length>0&&$(".userLimitReached").dialog({autoOpen:!0,title:"Simple Pop up",dialogClass:"userLimitReached-modal",show:"fadeIn",hide:"fadeOut",closeOnEscape:!0,draggable:!1,modal:!0,width:1e3,resizable:!1}),f=!1,localStorage.getItem("openInNewWindow")!=null&&localStorage.getItem("openInNewWindow")=="true"&&($(".openInNewWindow").prop("checked",!0),f=!0),f){var p=screen.height,w=screen.width,b=window.open(openInNewWindowUrl,"_blank","location=no,menubar=no,titlebar=no,toolbar=no,scrollbars=yes,resizable=yes,top=0,left=0, width="+w+",height="+p);b==undefined&&$(".popup-alert").dialog({autoOpen:!0,title:"Simple Pop up",dialogClass:"simple-modal",show:"fadeIn",hide:"fadeOut",closeOnEscape:!0,draggable:!1,modal:!0,buttons:{Ok:{click:function(){$(this).dialog("close")},text:"Ok","class":"btn rmsBtn"}},resizable:!1})}setTimeout(function(){},100)});